纯机翻

## 2

分布式数据流计算作为物理执行计划运行，该计划将操作员映射到预配置的计算资源（或工作程序）。执行计划是一个有向图，其顶点是运算符实例（每个在特定的工作程序上），而边沿是数据通道（在工作程序内和工作程序之间）。运算符可以是无状态的（例如，过滤器，地图）或有状态的（例如，窗口，滚动聚合）。通常通过操作符实例之间的键对状态进行分区，以便可以以数据并行方式执行计算。在计算的每个时间点，每个工作人员（及其关联的操作员实例）负责一组键及其关联的状态。

状态迁移是更改为工作人员分配密钥并相应地重新分配各自状态的过程。良好的状态迁移技术应该是无中断的（迁移过程中响应延迟的最小增加），短暂的（迁移在短时间内完成）和资源有效的（迁移期间需要的最少额外资源）。

我们概述了分布式流系统中现有的状态迁移策略，并确定了它们的局限性。然后，我们回顾数据库系统采用的实时状态迁移方法，并直观地了解Megaphone的方法，以将这种迁移技术引入流数据流。

### 2.1

当前的系统不能以非破坏性和成本有效的方式实现状态迁移。 现有的流处理器一次就迁移状态，但是在暂停现有计算还是开始并发计算方面有所不同。 如图1所示，暂停计算的策略可能会导致高延迟尖峰，尤其是在要移动的状态较大时。 另一方面，数据流复制技术减少了中断，但代价是对资源的高要求以及对输入重复和输出重复数据删除的支持。 例如，要使ChronoStream从具有x个实例的配置迁移到具有y个实例的新配置，在迁移期间需要x + y个实例。

### 2.2

数据库系统已经实现了优化，这些优化明确地针对了我们在上一节中确定的限制，即不可用性和资源需求。尽管在数据组织，工作负载特征，等待时间要求和运行时执行方面，流数据流系统与数据库存在显着差异，但是在两种设置中，状态迁移的基本挑战是共同的。

Albatross [11]采用VM实时迁移技术，并在[8]中使用动态限制机制对其进行了进一步优化，该机制可在迁移期间适应数据传输速率，从而使源节点中的租户始终能够满足其SLO。 Prorea [25]结合了基于推的热页面迁移和基于拉的冷页面迁移。 Zephyr [13]提出了一种在无共享事务数据库中进行实时迁移的技术，该技术不会导致系统停机，也不会中断非迁移租户的服务。

最复杂的方法是Squall [12]，它通过（部分）使用事务机制来实现迁移，从而将状态迁移与事务处理交织在一起。 Squall引入了许多有趣的优化，例如预取和拆分重新配置，以避免在单个分区上发生争用。在迁移过程中，如果需要处理迁移记录但尚不可用，则Squall会引入事务来获取记录（完成迁移）。这会沿关键路径引入延迟，并且事务锁定机制可能会阻碍吞吐量，但是系统既不会暂停也不会被复制。据我们所知，没有一个流处理器实现这种细粒度的迁移技术。

### 2.3

将现有的细粒度实时迁移技术应用于流引擎并非易事。尽管诸如Squall之类的系统将OLTP工作负载用于短期事务，但流作业却是长期运行的。在这种情况下，Squall在初始化期间获取全局锁定的方法不是可行的解决方案。此外，Squall的许多补救措施都是被动的，而不是主动的（因为它必须支持难以预测数据需求的一般交易），这可能会在关键路径上带来显着的延迟。

Megaphone迁移机制背后的核心思想是将细粒度状态迁移与数据处理进行复用，并使用流处理器中常见的逻辑时间进行协调。这是一种主动迁移方法，它依赖于流计算的指定结构以及流处理器使用逻辑时间与高频进行协调的能力。包括Megaphone在内的此类系统通过预先计划特定工作人员的数据集合点而避免了系统范围的锁定。

## 3

扩音器的功能依赖于核心流数据流概念，例如逻辑时间，进度跟踪，数据并行运算符和状态管理。 这些概念的基本实现存在于所有现代流处理器中，例如Apache Flink [10]，Millwheel [5]和Google Dataflow [6]。 在下文中，我们以Naiad [22]及时的数据流模型为基础来描述Megaphone的迁移机制。 及时的数据流本机支持其他系统中最通用形式的数据流功能的超集。

### 3.1

Naiad中的流计算被表示为及时的数据流：有向图（可能是循环图），其中节点表示有状态的运算符，边表示运算符之间的数据流。及时数据流中的每个数据记录都带有逻辑时间戳，操作员可以维护或可能提前每个记录的时间戳。示例性时间戳包括代表毫秒或事务标识符的整数，但通常可以是定义了部分顺序的任何不透明值集。及时的数据流系统会跟踪时间戳的存在，并报告已处理的时间戳不再存在于数据流中，这表明了流计算的向前进展。

属于一个或多个OS进程的多个工作程序（线程）执行及时的数据流，这些进程可能驻留在网络集群的一台或多台机器中。如图2所示，工作程序通过在数据通道上交换消息（无共享范式）彼此通信。每个工作程序都有整个及时数据流图的本地副本，并在数据流的（不相交）分区上执行此图中的所有运算符。输入数据。每个工作程序与其他工作程序同时重复执行数据流运算符，从而跨数据交换通道发送和接收数据。由于这种异步执行模型，并发的“运行中”时间戳是规则而不是例外。

当及时的工人执行时，他们将他们产生和消耗的逻辑时间戳的数量传达给所有其他工人。该信息允许每个工作人员确定任何数据流操作员仍可能在其输入中看到任何给定时间戳的可能性。及时的工人以边界的形式将这些信息提供给操作员：

定义1.边界F是一组逻辑时间戳，因此1. F的任何元素都不严格大于F的另一个元素2. 2.仍可能接收到的消息的所有时间戳都是
大于或等于F的某个元素。

